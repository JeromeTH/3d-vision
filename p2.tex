\documentclass{article}

% Packages for math and formatting
\usepackage{amsmath, amssymb}
\usepackage{geometry}
\usepackage{graphicx}
\usepackage{bm}
\usepackage{physics}


% Page setup
\geometry{margin=1in}

\begin{document}
Problem: 
Given an image
$(u, v) \in [0, W) \times [0, H)$  
sampled from $360$ view by 
$\lambda(u) = 2\pi \frac{u}{W} - \pi $
$\phi(v) = \frac{\pi}{2} - \pi\frac{v}{H} $

\section{Part 1}
General Strategy outline: 
\begin{itemize}
    \item First, we want to transform the image into pixel on the viewing sphere in 3D space obtaining $(\lambda_w, \phi_w)$. 
    \item Then, rotate the sphere to position relative to the camera, obtaining $(\lambda_c, \phi_c)$. 
    \item Sample (u', v') within latitude range and longtitude range $(\pi / 4, -\pi / 4)$ from $(\lambda_c, \phi_c)$.
\end{itemize}

\subsection{Transforming image into 3D Dome}
The affine transformation $\tau : (u, v) \rightarrow (\lambda_w, \phi_w)$ can be seen as linear transformation in homogenous $P^2$ space, 
denoted by matrix multiplication: 
\begin{align*}
    \begin{bmatrix}
    \frac{2\pi}{W} & 0 & -\pi \\
    0 & \frac{-\pi}{H} & \frac{\pi}{2} \\
    0 & 0 & 1
    \end{bmatrix}
    \begin{bmatrix}
        u \\ v \\ 1
    \end{bmatrix}
    = S \begin{bmatrix}
        u \\ v \\ 1
    \end{bmatrix} = 
    \begin{bmatrix}
        \lambda_w \\ \phi_w \\ 1
    \end{bmatrix} 
\end{align*}

Computing the inverse allows us to sample points on the 3D sphere using the information in the image by
$$
\begin{bmatrix}
    u(\lambda_w) \\ v(\phi_w) \\ 1
\end{bmatrix} = 
\begin{bmatrix}
    \frac{W}{2\pi} & 0 & \frac{W}{2} \\
    0 & \frac{-H}{\pi} & \frac{H}{2} \\
    0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
    \lambda_w \\ \phi_w \\ 1
\end{bmatrix} = 
S^{-1} \begin{bmatrix}
    \lambda_w \\ \phi_w \\ 1
\end{bmatrix}
$$



\subsection{Rotating sphere to camera perspective}
Applying rotation matrices on the world coordinates to obtain the camera view, we have:
\begin{align*}
\begin{bmatrix}
\lambda_c \\ \phi_c \\ 1 
\end{bmatrix} &= 
P^{-1} R_{yaw}(30^\circ) R_{pitch}(10^\circ) R_{roll}(25^\circ) P
\begin{bmatrix}
    \lambda_w \\ \phi_w \\ 1
\end{bmatrix} \\
&= R\begin{bmatrix}
    \lambda_w \\ \phi_w \\ 1
\end{bmatrix}
\end{align*}

Where $R$ is the camera rotation matrix and $P$ is the matrix transforming polar coordinates to cartesian coordinates. 
We let $x$ be the horizonal aspect of the view, $y$ be the vertical, and $z$ be the depth. 
According to the rotations conventions, we have 
\begin{align*}
    R_{yaw}(30^\circ) &= \begin{bmatrix}
        \cos 30^\circ & 0 & -\sin 30^\circ \\
        0 & 1 & 0 \\
        \sin 30^\circ & 0 & cos 30^\circ
    \end{bmatrix} && \text{ y axis} \\
    R_{pitch}(10^\circ) &= \begin{bmatrix}
        1 & 0 & 0 \\
        0 & \cos 10^\circ & -\sin 10^\circ \\
        0 & \sin 10^\circ & \cos 10^\circ
    \end{bmatrix} && \text{ x axis} \\ 
    R_{roll}(25^\circ) &= \begin{bmatrix}
        \cos 25^\circ & -\sin 25^\circ & 0 \\
        \sin 25^\circ & \cos 25^\circ & 0 \\
        0 & 0 & 1
    \end{bmatrix} && \text{ z axis}
\end{align*}

\subsection{Sampling from Camera coordinates}
We sample $(u_c, v_c) \in [0, W) \times [0, H)$ with 
$\lambda_c(u_c) = \frac{\pi}{2W}u_c - \frac{\pi}{4}$, $\phi_c(v_c) = \frac{\pi}{2H}v_c - \frac{\pi}{4}$. 
This way, the range of sampled angles for $\lambda_c, \phi_c \in (-\frac{\pi}{4}, \frac{\pi}{4})$, which corresponds to a $90^\circ$ viewing angle. 

\subsection{Putting it together}. 
Therefore, we can construct the perspective view image (new) from the original image (old) by composing transformations of each step. 
Giving us 
\[
New(u_c, v_c) = Old(
S^{-1}
R^{-1}
\begin{bmatrix}
    \frac{\pi}{2W}u_c - \frac{\pi}{4} \\ 
    \frac{\pi}{2H}v_c - \frac{\pi}{4} \\ 
    1
\end{bmatrix}
)
\] 

\section{Part 2}
Starting from any orientation, you can yaw $90$,$ -90$, and $180$ to obtain $3$ faces. And pitch up $90$ and down $90$ to obtain the other $2$. 
Therefore, let $R$ be as defined in part $1$. Then the question is to find $r, p, y$ such that 
$R(r, p, y) = R_\Delta R(25, 10, 30)$
where $R_\Delta \in \{R_{yaw}(90), R_{yaw}(-90), R_{yaw}(180), R_{pitch}(90), R_{pitch}(-90)\}$

\end{document}